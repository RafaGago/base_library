/* Autogenerated file, don't edit */
/* AUTOGENERATE: src/bl/base/alnls/array_linked_list_u32_extended.c */
/*---------------------------------------------------------------------------*/

#include <bl/base/impl/array_linked_list_u32.h>

static void alnls_u32_find_two_previous_nodes(
  alnls_u32* l, alnls_u32_it* prev, alnls_u32_it* prev2, alnls_u32_it val
  )
{
  bl_assert (!alnls_u32_is_empty (l));
  *prev2       = alnls_u32_it_end (l);
  *prev        = alnls_u32_it_end (l);
  alnls_u32_it now = alnls_u32_it_begin (l);

  while (now != val) {
    *prev2 = *prev;
    *prev  = now;
    now    = alnls_u32_it_next (l, now);
  }
}
/* TODO: regular insert ? */
/*---------------------------------------------------------------------------*/
BL_EXPORT void alnls_u32_insert_tail (alnls_u32* l, alnls_u32_it n)
{
  bl_assert (alnls_u32_it_next (l, n) == alnls_u32_it_end (l));
  if (!alnls_u32_is_empty (l)) {
    alnls_u32_it tail, subtail;
    alnls_u32_find_two_previous_nodes (l, &tail, &subtail, alnls_u32_it_end (l));
    l->nodes[tail] = n;
    bl_assert (alnls_u32_it_next (l, tail) == n); /* overflow check */
  }
  else {
    l->head = n;
    bl_assert (alnls_u32_it_begin (l) == n); /* overflow check */
  }
  ++l->size;
}
/*---------------------------------------------------------------------------*/
BL_EXPORT alnls_u32_it alnls_u32_drop (alnls_u32* l, alnls_u32_it n)
{
  bl_assert (alnls_u32_it_in_range( l, n));
  bl_assert (!alnls_u32_node_is_free (l, n));

  if (alnls_u32_is_empty (l)) {
    return alnls_u32_it_end (l);
  }
  alnls_u32_it should_be_n, prev, find;
  find = alnls_u32_it_next (l, n);
  alnls_u32_find_two_previous_nodes (l, &should_be_n, &prev, find);
  bl_assert (should_be_n == n);
  if (prev != alnls_u32_it_end (l)) {
    l->nodes[prev] = find;
  }
  else {
    l->head = alnls_u32_it_end (l);
  }
  l->nodes[n] = alnls_u32_it_end (l);
  --l->size;
  return prev;
}
/*---------------------------------------------------------------------------*/
BL_EXPORT alnls_u32_it alnls_u32_drop_tail (alnls_u32* l)
{
  if (alnls_u32_is_empty (l)) {
    return alnls_u32_it_end (l);
  }
  alnls_u32_it tail, subtail;
  alnls_u32_find_two_previous_nodes (l, &tail, &subtail, alnls_u32_it_end (l));
  if (subtail != alnls_u32_it_end (l)) {
    l->nodes[subtail] = alnls_u32_it_end (l);
  }
  else {
    l->head = alnls_u32_it_end (l);
  }
  --l->size;
  return tail;
}
/*---------------------------------------------------------------------------*/
